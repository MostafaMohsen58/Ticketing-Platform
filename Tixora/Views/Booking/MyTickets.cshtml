@using Tixora.Settings

@model IEnumerable<Booking>

@{
    ViewData["Title"] = "My Tickets";
}

<div class="container mt-120" style="background: linear-gradient(to right, #f9f9f9, #f1f1f1);">
    <h2 class="text-center mb-5 fw-bold" style="color: #2f3138;">My Tickets</h2>

    <div class="accordion" id="ticketsAccordion">

        <!-- Entertainment Tickets -->
        <div class="accordion-item mb-4 border-0">
            <h2 class="accordion-header" id="headingEntertainment">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseEntertainment" aria-expanded="false" aria-controls="collapseEntertainment">
                    <i class="fas fa-theater-masks me-2"></i><strong>Entertainment Tickets</strong>
                </button>
            </h2>
            <div id="collapseEntertainment" class="accordion-collapse collapse" aria-labelledby="headingEntertainment">
                <div class="accordion-body">
                    @if (!Model.Any(b => b.Ticket.Event.Category == "Entertainment"))
                    {
                        <div class="alert alert-info text-center">You have no entertainment tickets yet.</div>
                    }
                    else
                    {
                        <div class="row g-4">
                            @foreach (var ticket in Model.Where(b => b.Ticket.Event.Category == "Entertainment"))
                            {
                                <div class="col-12">
                                    <div class="card border-0 rounded-3 shadow-sm mb-4">
                                        <div class="row g-0">
                                            <!-- Ticket Image -->
                                            <div class="col-md-4 ticket-image" style="background-image: url('@(ticket.Ticket.Event.ImageUrl != null ? 
                                                        $"{FileSettings.ImagePath}/{ticket.Ticket.Event.ImageUrl}" : "/images/placeholder.jpg")');">
                                            
                                            </div>

                                            <!-- Ticket Details -->
                                            <div class="col-md-8">
                                                <div class="card-body">
                                                    <h5 class="card-title" style="font-weight: bold; color: #2f3138;">@ticket.Ticket.Event.Title</h5>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <p><i class="fas fa-check-circle me-1" style="color: #6c757d;"></i><strong>Status:</strong> <span class="badge bg-success">Delivered</span></p>
                                                            <p><i class="fas fa-tags me-1" style="color: #6c757d;"></i><strong>Category:</strong> @ticket.Ticket.TicketCategory.Name</p>

                                                            <p><i class="fas fa-map-marker-alt me-1" style="color: #6c757d;"></i><strong>Venue:</strong> @ticket.Ticket.Event.Venue.Name</p>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <p><i class="fas fa-clock me-1" style="color: #6c757d;"></i><strong>Time:</strong> @ticket.BookedAt.ToString("hh:mm tt")</p>
                                                            <p><i class="fas fa-calendar-alt me-1" style="color: #6c757d;"></i><strong>Date:</strong> @ticket.BookedAt.ToString("ddd dd MMM yyyy")</p>

                                                            <p><i class="fas fa-id-card me-1" style="color: #6c757d;"></i><strong>Ticket ID:</strong> @ticket.UserId</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Sports Tickets -->
        <div class="accordion-item mb-4 border-0">
            <h2 class="accordion-header" id="headingSports">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseSports" aria-expanded="false" aria-controls="collapseSports">
                    <i class="fas fa-futbol me-2"></i><strong>Sports Tickets</strong>
                </button>
            </h2>
            <div id="collapseSports" class="accordion-collapse collapse" aria-labelledby="headingSports">
                <div class="accordion-body">
                    @if (!Model.Any(b => b.Ticket.Event.Category == "Matches"))
                    {
                        <div class="alert alert-info text-center">You have no sports tickets yet.</div>
                    }
                    else
                    {
                        <div class="row g-4">
                            @foreach (var ticket in Model.Where(b => b.Ticket.Event.Category == "Matches"))
                            {
                                <div class="col-12">
                                    <div class="card border-0 rounded-3 shadow-sm mb-4">
                                        <div class="row g-0">
                                            <!-- Ticket Image -->
                                            <div class="col-md-4 ticket-image" style="background-image: url('@(ticket.Ticket.Event.ImageUrl != null ? $"{FileSettings.ImagePath}/{ticket.Ticket.Event.ImageUrl}" : "/images/placeholder.jpg")');">
                                                <img src="@((ticket.Ticket.Event.ImageUrl != null ? $"{FileSettings.ImagePath}/{ticket.Ticket.Event.ImageUrl}" : "/images/placeholder.jpg"))" alt="Event Image" class="img-fluid" style="object-fit: cover; width: 100%; height: 100%;">
                                            </div>

                                            <!-- Ticket Details -->
                                            <div class="col-md-8">
                                                <div class="card-body">
                                                    <h5 class="card-title" style="font-weight: bold; color: #2f3138;">@ticket.Ticket.Event.Title</h5>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <p><i class="fas fa-check-circle me-1" style="color: #6c757d;"></i><strong>Status:</strong> <span class="badge bg-success">Delivered</span></p>
                                                            <p><i class="fas fa-tags me-1" style="color: #6c757d;"></i><strong>Category:</strong> @ticket.Ticket.TicketCategory.Name</p>

                                                            <p><i class="fas fa-map-marker-alt me-1" style="color: #6c757d;"></i><strong>Venue:</strong> @ticket.Ticket.Event.Venue.Name</p>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <p><i class="fas fa-clock me-1" style="color: #6c757d;"></i><strong>Time:</strong> @ticket.BookedAt.ToString("hh:mm tt")</p>
                                                            <p><i class="fas fa-calendar-alt me-1" style="color: #6c757d;"></i><strong>Date:</strong> @ticket.BookedAt.ToString("ddd dd MMM yyyy")</p>

                                                            <p><i class="fas fa-id-card me-1" style="color: #6c757d;"></i><strong>Ticket ID:</strong> @ticket.UserId</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Payment History -->
        <div class="accordion-item mb-4 border-0">
            <h2 class="accordion-header" id="headingPayments">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapsePayments" aria-expanded="false" aria-controls="collapsePayments">
                    <i class="fas fa-receipt me-2"></i><strong>Payment History</strong>
                </button>
            </h2>
            <div id="collapsePayments" class="accordion-collapse collapse" aria-labelledby="headingPayments">
                <div class="accordion-body">
                    @if (!Model.Any())
                    {
                        <div class="alert alert-info text-center">You have no payment history.</div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table custom-table align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>Booking No.</th>
                                        <th>Booked At</th>
                                        <th>Payment Method</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var ticket in Model)
                                    {
                                        <tr>
                                            <td><strong>#@ticket.Id</strong></td>
                                            <td>@ticket.BookedAt.ToString("dd MMM yyyy")</td>
                                            <td><span class="badge bg-light text-dark"><i class="fab fa-cc-stripe me-1"></i> Stripe</span></td>
                                            <td><span class="text-success fw-bold">@(ticket.TotalAmount) $</span></td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link href="~/css/mytickets.css" rel="stylesheet" />
    <style>
        .accordion-button {
            background-color: white;
            color: #2f3138;
            font-weight: bold;
            border: 1px solid #dee2e6;
        }

            .accordion-button:not(.collapsed) {
                background-color: #f8f9fa;
            }

        .ticket-image {
            background-size: cover;
            background-position: center;
            min-height: 220px;
            max-height:250px;
            border-top-left-radius: .5rem;
            border-bottom-left-radius: .5rem;
        }

            .ticket-image img {
                object-fit: cover;
                width: 100%;
                height: 100%;
            }

        .card-body {
            font-size: 14px;
            color: #2f3138;
        }

        .badge.bg-success {
            background-color: #198754;
        }

        .table th {
            background-color: #f82249;
            color: white;
        }

        .table td {
            font-size: 14px;
            color: #2f3138;
        }

        .table th, .table td {
            vertical-align: middle;
        }

        .custom-table th, .custom-table td {
            padding: 1rem;
            border-top: 2px solid #dee2e6;
        }

        .table td:hover {
            background-color: transparent;
            color: inherit;
        }

        .accordion-button:hover {
            background-color: #f82249;
            color: white;
        }

        .accordion-button:not(.collapsed) {
            background-color: #f8f9fa;
            color: #2f3138;
        }
    </style>
}

@section Scripts {
    <script>
        // Add smooth scroll to accordion items when opened
        document.querySelectorAll('.accordion-button').forEach(button => {
            button.addEventListener('click', () => {
                setTimeout(() => {
                    button.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            });
        });
    </script>
}
    
